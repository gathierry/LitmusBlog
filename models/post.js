var mongodb = require('./db');var markdown = require('markdown').markdown;function Post(title, post, time) {  this.title = title;  this.post = post;  if (time) this.time = time;  else this.time = new Date();}module.exports = Post;Post.prototype.save = function save(callback) {  var post = {    title:this.title,    post:this.post,    time:this.time,  };  mongodb.open(function(err, db) {    if(err) return callback(err);    db.collection('posts', function(err, collection) {      if (err) {        mongodb.close();        return callback(err);      }      collection.insert(post, {        safe:true      }, function(err, post) {           mongodb.close();           callback(err, post);      });    });  });};  Post.getTen = function getTen(page, callback) {    mongodb.open(function(err, db) {        if (err) return callback(err);        db.collection('posts', function(err, collection) {            if (err) {                mongodb.close();                return callback(err);            }            var query = {};            collection.find(query,{skip:(page-1)*10, limit:11}).sort({                time: -1            }).toArray(function (err, docs) {                    mongodb.close();                    if(err) callback(err, null);                    var posts= [];                    docs.forEach(function (doc, index) {                        var post = new Post(doc.title, doc.post, doc.time);                        var now = post.time;                        post.time = now.getFullYear() + "-" + (now.getUTCMonth()+1) + "-" + now.getUTCDate();                        posts.push(post);                    });                console.log('post' + posts);                callback(null, posts);            });        });    });};Post.getOne = function getOne(title, callback) {    mongodb.open(function(err, db) {        if (err) return callback(err);        db.collection('posts', function(err, collection) {            if (err) {                mongodb.close();                return callback(err);            }            var query = {};            if(title) query.title = title;            collection.find(query).sort({                time: -1            }).toArray(function (err, docs) {                    mongodb.close();                    if(err) callback(err, null);                    var posts= [];                    docs.forEach(function (doc, index) {                        var post = new Post(doc.title, doc.post, doc.time);                        var now = post.time;                        post.time = now.getFullYear() + "-" + (now.getUTCMonth()+1) + "-" + now.getUTCDate();                        posts.push(post);                    });                callback(null, posts);            });        });    });};Post.getArchieve = function(callback) {    mongodb.open(function(err, db) {        if (err) return callback(err);        db.collection('posts', function(err, collection) {            if (err) {                mongodb.close();                return callback(err);            }            collection.find({},{"time":1, "title":1}).sort({                time: -1            }).toArray(function (err, docs) {                    mongodb.close();                    if(err) callback(err, null);                    var posts= [];                    docs.forEach(function (doc, index) {                        var post = new Post(doc.title, doc.post, doc.time);                        var now = post.time;                        post.time = now.getFullYear() + "-" + (now.getUTCMonth()+1);                        posts.push(post);                    });                callback(null, posts);            });        });    });};