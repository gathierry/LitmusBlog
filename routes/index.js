/* * GET home page. */Post = require('../models/post.js');Modify = require('../models/modify.js');var fs = require('fs');var tags = ["Life in France", "Computer Science", "Reading & Writing"]; var timelines;/* req.query： 处理 get 请求，获取 get 请求参数 req.params： 处理 /:xxx 形式的 get 或 post 请求，获取请求参数 req.body： 处理 post 请求，获取 post 请求体 req.param()： 处理 get 和 post 请求，但查找优先级由高到低为 req.params→req.body→req.query */module.exports = function(app){  app.get('/', function(req, res){      res.render('index', {           title: 'Litmus Blog',          tags:tags,          timelines:timelines,      });  });  app.get('/blog', function(req, res){        var page = req.query.p;      if(!page) page = 1;      else page = parseInt(page);      Post.getTen(page, null, function(err, posts){          if (err) posts = [];          res.render('blog', {              title:'Blog',              page:page,              posts:posts,              tags:tags,              timelines:timelines,          });      });  });  app.get('/tag/:tag', function(req, res){        var page = req.query.p;      if(!page) page = 1;      else page = parseInt(page);      var tag = req.params.tag;      Post.getTen(page, tag, function(err, posts){          if (err) posts = [];                  res.render('blog', {              title:'Blog',              page:page,              posts:posts,              postsLen:posts.length,              tags:tags,              timelines:timelines,          });      });  });    app.get('/blog/:title', function(req, res){      Post.getOne(req.params.title, function(err, post){          if (err) post = [];          res.render('article', {              title:req.params.title,              post:post,              tags:tags,              timelines:timelines,          });      });  });  app.get('/post', function(req, res){      res.render('post', {          timelines:timelines,          tags:tags,          title:'New Blog',      });  });  app.post('/post', function(req, res){          //upload image     var imgSrc = '';     var image = req.files.cImage;     if (image.size > 0) imgSrc = image.path;     else fs.unlinkSync(image.path);     var post = new Post(req.body.title, req.body.post, new Date(), req.body.tag, imgSrc);     if (req.body.title.length || req.body.post.length) {         post.save(function(err) {             return res.redirect('/blog');         });     }   });  app.get('/blog/:title/delete', function(req, res){      Modify.deleteArticle(req.params.title, function(err){          return res.redirect('/blog');            });      });  app.get('/blog/:title/update', function(req, res){      Post.getOne(req.params.title, function(err, post){          if (err) post = [];          res.render('post', {              title:req.params.title,              post:post,              tags:tags,              timelines:timelines,          });      });         });           app.post('/blog/:title/update', function(req, res){      var imgSrc = '';     var image = req.files.cImage;     if (image.size > 0) imgSrc = image.path;     else fs.unlinkSync(image.path);     var post = new Post(req.body.title, req.body.post, new Date(), req.body.tag, imgSrc);      if (req.body.title.length || req.body.post.length) {          post.save(function(err) {              return res.redirect('/blog');          });      }   });        app.get('/search', function(req, res){      var page = req.query.p;      if (!page) page = 1;      else page = parseInt(page);      Post.search(req.query.keyword, page, function (err, posts) {          if (err) posts = [];          res.render('blog',{              title:'Search',              page:page,              posts:posts,              tags:tags,              keyword:req.query.keyword,              timelines:timelines,          });      });   });    };